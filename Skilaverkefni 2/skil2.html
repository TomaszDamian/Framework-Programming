<script type="text/javascript">
window.onload=function(){
	var canvas=document.createElement('canvas');
	var ctx = canvas.getContext("2d");
	var TurningPoint = 0

	canvas.id='thecanvas';
	canvas.width='800';
	canvas.height='800';
	canvas.style.border='1px solid red';
	document.body.appendChild(canvas);
	
	function canvasClear(){
		//made to just clear the canvas so the tanks could be redrawn
		ctx.clearRect(0, 0, canvas.width, canvas.height);
	}

	tank = function(args){
		var x = args.x;
		var y = args.y;
		var width = args.width;
		var height = args.height;
		var ImageLink = args.ImageLink;
		var Direction = args.Direction
		img = new Image()
		img.src = ImageLink
		
		this.image = img
		this.x = x;
		this.y = y;
		this.width = width;
		this.height = height;
		this.ImageLink = ImageLink;
		this.FacingDirection = Direction
		this.deg = 0
		this.angles_left_to_turn_left = 0
		this.angles_left_to_turn_right = 0
	}
	tank.prototype.Draw = function(args) {
		//Made it so there is no Clear canvas in the Draw function
		//Draw shouldn't also erase the canvas		
		ctx.save();
		ctx.translate(this.x,this.y);
		ctx.rotate(this.deg*Math.PI/180);
		ctx.drawImage(this.image,-(this.height/2),-(this.width/2),100,100);
		ctx.translate(0,0);
		ctx.restore();
	};
	tank.prototype.rotateLeft = function() {
		this.deg += 6;
	};
	tank.prototype.rotateRight = function() {
		this.deg -= 6;
	};
	tank.prototype.moveForward = function() {
		//https://i.imgur.com/xI9DdKz.png
		//reference as to what direction is forward
		if(this.FacingDirection === 0){
			this.x += 10;
		}
		else if(this.FacingDirection === 1){
			this.y += 10;
		}
		else if(this.FacingDirection === 2){
			this.x -= 10;
		}
		else if(this.FacingDirection === 3){
			this.y -= 10;
		}
	};
	tank.prototype.moveBackwards = function() {
		if(this.FacingDirection === 0){
			this.x -= 10;
		}
		else if(this.FacingDirection === 1){
			this.y -= 10;
		}
		else if(this.FacingDirection === 2){
			this.x += 10;
		}
		else if(this.FacingDirection === 3){
			this.y += 10
		}
	};
	tank.prototype.implement_physical_laws = function() {
		//If the Tank still has Angles_lef_to_turn_x.
		//decrease Angels_left_to_turn_x and,
		//increase/decrease this.deg by calling this.rotateLeft/right();.
		if(this.angles_left_to_turn_left != 0){
			this.angles_left_to_turn_left -= 1;
			this.rotateLeft();
		};
		//works the same as the one above.
		//this one just makes it rotate to the right
		if(this.angles_left_to_turn_right != 0){
			this.angles_left_to_turn_right -= 1;
			this.rotateRight();
		};
	};
	
	TankOne = new tank({x:100,y:100,width:100,height:100,ImageLink:"https://i.imgur.com/OZMs74X.png",Direction:0});
	TankTwo = new tank({x:500,y:500,width:100,height:100,ImageLink:"https://i.imgur.com/QQfvIjZ.png",Direction:2});
	
	//setTimeout to let the image load before drawing it
	setTimeout(function(){
		setInterval(function(){
			//clear canvas..
			canvasClear();
			
			//Draw the Tanks on the canvas..
			TankOne.Draw();
			TankTwo.Draw();

			//turning made possible
			TankOne.implement_physical_laws()
			TankTwo.implement_physical_laws()

			// forward and backwards movement
			if(TankOne.ForwardPedalDown === 1){
				TankOne.moveForward();
			} else if(TankOne.BackwardsPedalDown === 1){
				TankOne.moveBackwards();
			} else if(TankTwo.ForwardPedalDown === 1){
				TankTwo.moveForward();
			} else if(TankTwo.BackwardsPedalDown === 1){
				TankTwo.moveBackwards();
			}

			//Side to side animations
			if(TankOne.TurningRight === 1 && TankOne.angles_left_to_turn_right === 0){
				TankOne.angles_left_to_turn_right = 15;
				TankOne.FacingDirection +=1
				if(TankOne.FacingDirection === 4){
					TankOne.FacingDirection = 0
				};
			} else if(TankOne.TurningLeft === 1 && TankOne.angles_left_to_turn_left === 0){
				TankOne.angles_left_to_turn_left = 15;
				TankOne.FacingDirection -=1
					if(TankOne.FacingDirection === -1){
						TankOne.FacingDirection = 3
					};
			} else if(TankTwo.TurningRight === 1 && TankTwo.angles_left_to_turn_right === 0){
				TankTwo.angles_left_to_turn_right = 15;
				TankTwo.FacingDirection +=1
				if(TankTwo.FacingDirection === 4){
					TankTwo.FacingDirection = 0
				};
			} else if(TankTwo.TurningLeft === 1 && TankTwo.angles_left_to_turn_left === 0){
				TankTwo.angles_left_to_turn_left = 15;
				TankTwo.FacingDirection -=1
				if(TankTwo.FacingDirection === -1){
					TankTwo.FacingDirection = 3
				};
			}
		},25);
	},200)

	document.onkeydown = keypressed;
	function keypressed(event) {
		KeyNumber = event.keyCode;
		console.log(KeyNumber);
		switch(KeyNumber){
			//a key
			case 65:
				if(TankOne.angles_left_to_turn_right === 0){
					TankTwo.TurningRight = 1;
					
				};
				break;

			//d key
			case 68:
				if(TankOne.angles_left_to_turn_left === 0){
					TankOne.TurningLeft = 1;
					
					
				};
				break;

			//w key
			case 87:
				if (TankOne.angles_left_to_turn_right === 0 && TankOne.angles_left_to_turn_left === 0){
					TankOne.ForwardPedalDown = 1;
					console.log("hello")
				}
				break;

			//s key
			case 83:
				if (TankOne.angles_left_to_turn_right === 0 && TankOne.angles_left_to_turn_left === 0){TankOne.BackwardsPedalDown = 1;}
				break;

			// left arrow
			case 37:
				if(TankTwo.angles_left_to_turn_right === 0){
					TankTwo.TurningRight = 1;
					
					console.log(TankTwo.FacingDirection)
				};
				break;
			
			//right arrow
			case 39:
				if(TankTwo.angles_left_to_turn_left === 0){
					TankTwo.TurningLeft = 1;
					
					console.log(TankTwo.FacingDirection)
				};
				
				break;

			//up arrow 
			case 38:
				if (TankTwo.angles_left_to_turn_right === 0 && TankTwo.angles_left_to_turn_left === 0){TankTwo.ForwardPedalDown = 1;}
				break;

			//down arrow
			case 40:
				if (TankTwo.angles_left_to_turn_right === 0 && TankTwo.angles_left_to_turn_left === 0){TankTwo.BackwardsPedalDown = 1;}
				break;


			//r key to restart the game
			case 82:
				TankOne = new tank({x:100,y:100,width:100,height:100,ImageLink:"https://i.imgur.com/OZMs74X.png",Direction:0});
				TankTwo = new tank({x:500,y:500,width:100,height:100,ImageLink:"https://i.imgur.com/QQfvIjZ.png",Direction:2});
				break;
		};
		document.onkeyup = KeyReleased;
		function KeyReleased(event){
			switch(event.keyCode){
				case 87:
					TankOne.ForwardPedalDown = 0;
					break;

				case 83:
					TankOne.BackwardsPedalDown = 0;
					break;

				case 68:
					TankOne.TurningLeft = 0;
					break;
				
				case 65:
					TankOne.TurningRight = 0;

				case 38:
					TankTwo.ForwardPedalDown = 0;
					break;

				case 40:
					TankTwo.BackwardsPedalDown = 0;
					break;
				
				case 37:
					TankTwo.TurningRight = 0;
					break;

				case 39:
					TankTwo.TurningLeft = 0;
					break;
			}
		}
	};
}
</script>